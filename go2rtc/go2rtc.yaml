# go2rtc 설정 파일
# 문서: https://github.com/AlexxIT/go2rtc

log:
  level: info

# API 서버 (WebUI + REST)
api:
  listen: ":1984"
  origin: "*"

# RTSP 출력 서버 (cctv-worker용)
rtsp:
  listen: ":8554"
  default_query: "video"

# WebRTC 설정 (권장 스트리밍 방식, <1초 지연)
webrtc:
  listen: ":8555"  # TCP + UDP 모두 지원 (권장)
  ice_servers:
    - urls: [stun:stun.l.google.com:19302]
    - urls: [stun:stun1.l.google.com:19302]
  # IPv4만 사용 (IPv6 비활성화로 연결 속도 향상)
  filters:
    networks: [udp4, tcp4]
  # TURN 서버 (대칭 NAT 환경에서 필요시 활성화)
  # ice_servers:
  #   - urls: [stun:stun.l.google.com:19302]
  #   - urls: [turn:turn.example.com:443?transport=tcp]
  #     username: ${TURN_USERNAME}
  #     credential: ${TURN_CREDENTIAL}

# HLS 스트리밍 (WebRTC 실패시 폴백)
# 참고: go2rtc HLS는 설정 옵션이 제한적 (세션 타임아웃 5초 고정)
# 지연 최소화는 프론트엔드 HLS.js 설정으로 조절
hls:

# 스트림 정의
# 환경변수로 RTSP URL 구성
streams:
  # 채널 1
  ch1:
    - "rtsp://${RTSP_USERNAME}:${RTSP_PASSWORD}@${RTSP_HOST}:${RTSP_PORT}/live_01"

  # 채널 2
  ch2:
    - "rtsp://${RTSP_USERNAME}:${RTSP_PASSWORD}@${RTSP_HOST}:${RTSP_PORT}/live_02"

  # 채널 3
  ch3:
    - "rtsp://${RTSP_USERNAME}:${RTSP_PASSWORD}@${RTSP_HOST}:${RTSP_PORT}/live_03"

  # 채널 4
  ch4:
    - "rtsp://${RTSP_USERNAME}:${RTSP_PASSWORD}@${RTSP_HOST}:${RTSP_PORT}/live_04"

# FFmpeg 설정 (트랜스코딩 필요시)
ffmpeg:
  bin: ffmpeg
